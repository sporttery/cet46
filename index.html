<!DOCTYPE HTML>
<html>

<head>
	<meta charset="UTF-8" />
	<link rel="icon" href="img/app-icon.ico">
	<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" href="css/bootstrap.min.css" crossorigin="anonymous">

	<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
	<link rel="stylesheet" href="css/bootstrap-theme.min.css" crossorigin="anonymous">

	<link rel="stylesheet" href="css/layer.css" crossorigin="anonymous">

	<script src="js/jquery.min.js"></script>
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="js/bootstrap.min.js" crossorigin="anonymous"></script>
	<script src="js/layer.js"></script>
	<title>CET46数据分析软件-鸿博股份</title>
	<style>
		.folderTxt.form-control {
			width: 95%;
			margin-right: 10px;
			display: inline;
		}
	</style>
</head>

<body>
	<div class="container-fluid">
		<!-- Nav tabs -->
		<ul class="nav nav-tabs" role="tablist">
			<li role="presentation"><a href="#profile" aria-controls="profile" role="tab"
					data-toggle="tab">系统设置</a>
			</li>
			<li role="presentation" class="active"><a href="#main" aria-controls="main" role="tab" data-toggle="tab">数据处理</a></li>
			<li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">数据定义</a>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">

			<div role="tabpanel" class="tab-pane " id="profile">
				<input type="file" webkitdirectory directory class="hide" id="folderBtn" onchange="setFolder()" />
				
				<div class="view">
					<br />
					<div class="input-group">
						<span class="input-group-addon" style="cursor: pointer;" onclick="openDir($(this).next().val())" title="点击打开文件夹"> 数据文件夹 </span>
						<input type="text" class="form-control" placeholder="选择原始数据所在的文件夹..." />
						<span class="input-group-btn">
							<input class="btn btn-default" type="button" value="x" title="清除" />
							<input class="btn btn-default" type="button" value="..." />
						</span>
					</div>
					<br />
					<div class="input-group">
						<span class="input-group-addon" style="cursor: pointer;" onclick="openDir($(this).next().val())" title="点击打开文件夹"> 照片文件夹 </span>
						<input type="text" class="form-control" placeholder="选择照片所在的文件夹..." />
						<span class="input-group-btn">
							<input class="btn btn-default" type="button" value="x" title="清除" />
							<input class="btn btn-default" type="button" value="..." />
						</span>
					</div>
					<br />
					<div class="input-group">
						<span class="input-group-addon" style="cursor: pointer;" onclick="openDir($(this).next().val())" title="点击打开文件夹"> 二维码目录 </span>
						<input type="text" class="form-control" placeholder="选择二维码所在的文件夹..." />
						<span class="input-group-btn">
							<input class="btn btn-default" type="button" value="x" title="清除" />
							<input class="btn btn-default" type="button" value="..." />
						</span>
					</div>
					<br />
					<div class="input-group">
						<span class="input-group-addon" style="cursor: pointer;" onclick="openDir($(this).next().val())" title="点击打开文件夹"> 合格文件夹 </span>
						<input type="text" class="form-control" placeholder="选择合格数据输出的文件夹..." />
						<span class="input-group-btn">
							<input class="btn btn-default" type="button" value="x" title="清除" />
							<input class="btn btn-default" type="button" value="..." />
						</span>
					</div>
					<br />
					<div class="input-group">
						<span class="input-group-addon" style="cursor: pointer;" onclick="openDir($(this).next().val())" title="点击打开文件夹"> 错误文件夹 </span>
						<input type="text" class="form-control" placeholder="选择错误数据输出的文件夹..." />
						<span class="input-group-btn">
							<input class="btn btn-default" type="button" value="x" title="清除" />
							<input class="btn btn-default" type="button" value="..." />
						</span>
					</div>
					<br />
				</div>

				<div class="view" style="text-align: right;margin-top:20px;">
					<button class="btn btn-success" onclick="save()">保存</button>
					<button class="btn btn-default" onclick="restore()">取消</button>
					<button class="btn btn-link" onclick="nextStep(0)">下一步</button>
				</div>
			</div>
			<div role="tabpanel" class="tab-pane " id="messages">
				<input type="file" class="hide" id="fileBtn" onchange="chooseFile()" />
				<div class="view" style="line-height: 45px;">
					<button class="btn btn-primary" onclick="autoID()">自动识别</button>
					<span style="color:red;font-size: 12px;">自动识别功能，选择数据文件后，将自动识别并标识数据项</span>

				</div>
				<div class="view" style="line-height: 45px;">
					<table class="table table-striped table-bordered">
					<thead>
						<tr>
						<th>字段内容</th>
						<th>字段说明
						</th>
						<th><input type="checkbox" id="tableDataCkb" onchange="selectAll(this,'tableData')"  style="cursor:pointer;width:20px;height:20px"/><label for="tableDataCkb">启用</label></th>
						<th>输出顺序</th>
						</tr>
					</thead>
					<tbody id="tableData">
						<tr>
							<td colspan="4" style="text-align: center;">暂无数据</td>
						</tr>
					</tbody>
					</table>
				</div>
				<div class="view">
					<p>
						<input type="radio" name="chk_pic" id="chk_pic_no" value="-1" onchange="picChange()"><label for="chk_pic_no">不检测照片</label>
						<input type="radio" name="chk_qrcode" id="chk_qrcode_no" value="-1" onchange="qrcodeChange()"><label for="chk_qrcode_no">不检测二维码</label>
					</p>
				</div>
				<div class="view" style="text-align: right;margin-top:20px;">
					<button class="btn btn-success" onclick="save(true)">保存</button>
					<button class="btn btn-default" onclick="restore(true)">取消</button>
					<button class="btn btn-link" onclick="nextStep(1)">下一步</button>
				</div>
			</div>

			<div role="tabpanel" class="tab-pane active" id="main">
				<div class="view"  style="padding: 11px 0;">
					<div class="row">
						<div class="col-sm-4">
							<button class="btn btn-default disabled" disabled="disabled" id="btnFindFile" onclick="findFile(this)">查找文件</button>
							<button class="btn btn-default disabled" disabled="disabled" id="btnData"onclick="doit(this)">开始处理</button>	
							&nbsp;&nbsp;
							<input type="checkbox" id="includeSubFolder" /><label for="includeSubFolder">子目录</label>
							<!-- &nbsp;&nbsp;
							<button class="btn btn-link" onclick="location.reload()">刷新</button> -->
						</div>
						<div class="col-sm-8">
							<div class="input-group">
								<span class="input-group-addon" id="basic-addon2">数据格式:</span>
								<select id="filetype" class="form-control" aria-describedby="basic-addon2">
									<option value=".csv">.csv</option>
									<option value=".txt">.txt</option>
									<option value="*">所有文件</option>
								</select>
								<span class="input-group-addon" id="basic-addon3">考试日期</span>
								<input type="text" maxlength="20" class="form-control" aria-describedby="basic-addon3" id="ks_date"  />
								<span class="input-group-addon" id="basic-addon4">考试类型</span>
								<input type="text" maxlength="20" class="form-control" aria-describedby="basic-addon4" id="ks_type" value="CET4"  />
							</div>
						</div>
					</div>
				</div>
				<div class="view">
					<div class="progress">
						<div class="progress-bar progress-bar-striped" id="progressbar" role="progressbar"
							aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
						</div>
					</div>
				</div>

				<div class="view">
					<table class="table table-striped table-bordered">
						<thead>
							<tr>
								<th width="5%"><input type="checkbox" id="selectAll"  style="cursor:pointer;width:20px;height:20px" onchange="selectAll(this,'fileData')" /></th>
								<th>文件</th>
								<th  width="10%">状态</th>
								<th  width="20%">结果</th>
							</tr>
						</thead>
						<tbody id="fileData">
							<tr>
								<td colspan="4" style="text-align: center;">暂无数据</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
		</div>
	</div>


	<div class="modal fade" id="alert_like" tabindex="-1">
		<!-- 窗口声明 -->
		<div class="modal-dialog modal-sm">
			<!-- 内容声明 -->
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" data-dismiss="modal"><span>&times;</span></button>
					<h4 class="modal-title" id="myModalLabel">提示</h4>
				</div>
				<div class="modal-body">
					<div id="modal_con"></div>
				</div>
				<div class="modal-footer">
					<button id="ok_btn" class="btn btn-sm btn-warning" data-dismiss="modal">确 定</button>
				</div>
			</div>
		</div>
	</div>
	
	<script src="index.js"></script>
	<script>
		$(() => {
			loadDefaultConfig && loadDefaultConfig();
			$("#profile .input-group").each((idx, el) => {
				var group = $(el);
				folderEleArr[idx] = group.find("input:eq(0)");
				if (defaultFolderArr && defaultFolderArr[idx] && defaultFolderArr[idx].length > 2) {
					folderEleArr[idx].val(defaultFolderArr[idx]);
					folderArr[idx] = defaultFolderArr[idx];
				}
				var btn = group.find("input:last");
				btn.click(() => {
					folderArrIdx = idx;
					$("#folderBtn").click();
				});
				btn.prev().click(() => {
					folderEleArr[idx].val('');
					folderArr[idx] = '';
				});
			});
			tableData=[].concat(defaultTableData);
			setTableData();
			if(!checkFolder()){//目录检查没有通过
				$(".nav a")[0].click();
			}else if(tableData.length ==0){//数据定义没有通过
				$(".nav a")[2].click();
			}else { //如果数据定义已经Ok，开启查找文件功能
				$(".nav a")[parseInt(defaultNavTab)].click();
				$("#btnFindFile").removeAttr("disabled").removeClass("disabled");
				g_data_changed=-1;
			}
			var date = new Date();
			var month = (date.getMonth()+1);
			
			$("#ks_date").val(date.getFullYear()+"年"+(month>9?month:"0"+month)+"月");
		})
	</script>
</body>

</html>